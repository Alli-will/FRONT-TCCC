<app-menu></app-menu>
<div class="dashboard-container">
  <div class="dashboard-main">
    <h2 class="gradient-title">Dashboard de Engajamento (eNPS)</h2>
    <div class="dashboard-header-row stretch-ess" style="align-items: flex-start; gap: 32px;">
      <!-- NPS Geral -->
  <div class="diary-card score-card" style="margin: 0 auto; display: flex; flex-direction: column; align-items: flex-start; width:100%;">
        <div class="score-title" style="text-align: left; width: 100%;">
          <h2 class="gradient-title" style="margin:0; font-size:1.35rem;">eNPS da Última Pesquisa de Pulso</h2>
          <div class="score-sub" *ngIf="pulsoAtual">{{ pulsoAtual.titulo }} • {{ formatDate(pulsoAtual.createdAt) }} • 1ª pergunta</div>
          <div class="score-sub" *ngIf="!pulsoAtual">Nenhuma pesquisa de pulso encontrada</div>
        </div>
        <div class="score-circle-svg" style="position: relative; display: flex; justify-content: center; align-items: center; width: 100%;">
          <svg width="170" height="170">
            <circle
              cx="85"
              cy="85"
              r="76"
              stroke="#eaf6ff"
              stroke-width="16"
              fill="none"
            />
            <circle
              cx="85"
              cy="85"
              r="76"
              [attr.stroke]="getScoreColor()"
              stroke-width="16"
              fill="none"
              [attr.stroke-dasharray]="477.52"
              [attr.stroke-dashoffset]="477.52 - (essGeral) * 4.7752"
              stroke-linecap="round"
              style="transition: stroke-dashoffset 0.6s;"
              transform="rotate(-90 85 85)"
            />
            <text
              x="85"
              y="70"
              text-anchor="middle"
              font-size="2.4em"
              fill="#222"
              font-weight="bold"
              alignment-baseline="middle"
              dominant-baseline="middle"
            >
              {{ npsReal }}
            </text>
            <text x="85" y="92" text-anchor="middle" font-size="0.75em" fill="#666"></text>
            <text
              x="85"
              y="120"
              text-anchor="middle"
              font-size="1.05em"
              [attr.fill]="getScoreColor()"
              font-weight="600"
            >
              {{ getScoreLabel() }}
            </text>
            <!-- Ajuste: descer um pouco o texto do status -->
            
          </svg>
        </div>
        <div class="score-desc-wrapper" style="width:100%; display:flex; flex-direction:column; gap:18px; margin-top:28px;">
          <div class="score-desc" [style.background]="getScoreDescBg()" [style.color]="getScoreDescColor()" style="text-align:center;">
            {{ getScoreDesc() }}
          </div>
          <div class="metricas-row-below">
            <div class="metrica-card" style="min-width:0;">
              <span class="metrica-titulo">Colaboradores Ativos</span>
              <span class="metrica-valor" style="font-size:1.6rem;">{{ metricas.ativos }}</span>
            </div>
            <div class="metrica-card" style="min-width:0;">
              <span class="metrica-titulo">Respondentes</span>
              <span class="metrica-valor" style="font-size:1.6rem;">{{ metricas.respondentes }}</span>
            </div>
            <div class="metrica-card" style="min-width:0;">
              <span class="metrica-titulo">Detratores%</span>
              <span class="metrica-valor" style="font-size:1.6rem;">{{ metricas.detratoresPercent }}%</span>
            </div>
            <div class="metrica-card" style="min-width:0;">
              <span class="metrica-titulo">Promotores%</span>
              <span class="metrica-valor" style="font-size:1.6rem;">{{ metricas.promotoresPercent }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Seção de distribuição de emoções ocultada a pedido -->
    <!--
    <div class="emotion-indicators-section">
      ... (bloco original removido)
    </div>
    -->
  <!-- Seção de alertas de risco removida a pedido -->
    <div class="departamentos-section">
  <h2 class="gradient-title" style="margin:0 0 12px; font-size:1.35rem;">eNPS por Departamento</h2>
      <div class="dept-bars">
        <div class="dept-row" *ngFor="let d of deptBars">
          <div class="dept-header">
            <strong class="dept-nome">{{ d.nome }}</strong>
            <span class="dept-meta" *ngIf="!d.insuficiente; else insufMsg">NPS: {{ d.nps }} • Respondentes: {{ d.respondentes }}</span>
            <ng-template #insufMsg><span class="dept-meta warn">Respondentes: {{ d.respondentes }} • Não há respostas suficientes para análise</span></ng-template>
          </div>
          <div class="dept-bar" *ngIf="!d.insuficiente; else barraVazia">
            <div class="seg detratores" *ngIf="d.detratoresPct > 0" [style.width.%]="d.detratoresPct">Detratores {{ d.detratoresPct }}%</div>
            <div class="seg neutros" *ngIf="d.neutrosPct > 0" [style.width.%]="d.neutrosPct">Neutros {{ d.neutrosPct }}%</div>
            <div class="seg promotores" *ngIf="d.promotoresPct > 0" [style.width.%]="d.promotoresPct">Promotores {{ d.promotoresPct }}%</div>
          </div>
          <ng-template #barraVazia>
            <div class="dept-bar disabled">
              <div class="seg" style="width:100%; color:#666; background:#eee;">Sem dados suficientes</div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
    <!--
    <div class="colaboradores-section">
      <h3>Colaboradores</h3>
      <input
        type="text"
        placeholder="Buscar colaborador ou departamento..."
        [(ngModel)]="busca"
        (input)="buscarColaborador()"
      />
      <ul *ngIf="busca && resultadosBusca.length">
        <li *ngFor="let c of resultadosBusca">
          {{ c.nome }} - {{ c.departamento }} (Bem-estar: {{ c.bemEstar }})
        </li>
      </ul>
      <ul *ngIf="busca && !resultadosBusca.length">
        <li>Nenhum colaborador encontrado.</li>
      </ul>
      <ul *ngIf="!busca">
        <li *ngFor="let c of colaboradores">
          {{ c.nome }} - {{ c.departamento }} (Bem-estar: {{ c.bemEstar }})
        </li>
      </ul>
    </div>
    -->
  </div>
  <!-- Bloco de IA removido -->
</div>
