<app-menu></app-menu>
<div class="usuarios-container">
  <div class="header-row">
    <h2>Colaboradores Ativos</h2>
  <button *ngIf="isAdmin" routerLink="/usuarios/cadastrar" class="btn-primario" aria-label="Cadastrar novo colaborador">
      <span class="btn-icone" aria-hidden="true">＋</span>
      <span>Cadastrar Novo</span>
    </button>
  </div>
  <div *ngIf="erro" class="erro">{{ erro }}</div>
  <div *ngIf="loading">Carregando colaboradores...</div>
  <div *ngIf="!loading && colaboradoresAtivos.length === 0">Nenhum colaborador ativo encontrado.</div>
  <ul *ngIf="!loading && colaboradoresAtivos.length > 0" class="lista-colaboradores">
    <li *ngFor="let c of colaboradoresPaginados" class="colab-item">
      <div class="colab-avatar" [class.tem-avatar]="c.avatarUrl">
        <img *ngIf="c.avatarUrl; else defaultUserAvatar" [src]="c.avatarUrl" alt="Avatar de {{ c.nomeCompleto }}" loading="lazy" decoding="async" />
        <ng-template #defaultUserAvatar>
          <img src="assets/default-avatar.svg" alt="Avatar padrão" />
        </ng-template>
      </div>
      <div class="colab-texto">
        <strong class="colab-nome">{{ c.nomeCompleto }}</strong>
        <span *ngIf="editandoId !== c.id" class="colab-depto" (click)="iniciarEdicao(c)" [class.editavel]="isAdmin" title="Clique para editar" >
          {{ c.departamento }}
        </span>
        <div *ngIf="editandoId === c.id" class="dept-editor">
          <select #selDept [disabled]="salvandoDept" [value]="tempEditDeptId ?? ''" (change)="tempEditDeptId = selDept.value ? +selDept.value : null">
            <option value="">Sem departamento</option>
            <option *ngFor="let d of departamentos" [value]="d.id">{{ d.name || d.nome || d.title || d.label || d.departmentName || d.description || d }}</option>
          </select>
          <button type="button" class="btn-cancelar" (click)="cancelarEdicao()" [disabled]="salvandoDept">×</button>
          <button type="button" class="btn-confirmar" (click)="confirmarDepartamento(c)" [disabled]="salvandoDept">✓</button>
        </div>
        <div class="colab-actions" *ngIf="isAdmin && editandoId !== c.id">
          <button type="button" class="btn-alterar-depto" (click)="iniciarEdicao(c)">Alterar departamento</button>
        </div>
      </div>
    </li>
  </ul>
  <!-- Paginação -->
  <div *ngIf="!loading && totalPaginas > 1" class="paginacao-container">
    <button (click)="paginaAnterior()" [disabled]="paginaAtual === 1">Anterior</button>
    <ng-container *ngFor="let p of [].constructor(totalPaginas); let i = index">
      <button (click)="irParaPagina(i+1)" [class.ativa]="paginaAtual === (i+1)">{{ i+1 }}</button>
    </ng-container>
    <button (click)="proximaPagina()" [disabled]="paginaAtual === totalPaginas">Próxima</button>
  </div>
</div>
